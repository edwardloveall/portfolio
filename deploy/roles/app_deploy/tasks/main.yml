---
- name: Remove old github known_hosts
  ansible.builtin.command: "ssh-keygen -R github.com"
  changed_when: true

- name: Add github key to known_hosts
  ansible.builtin.shell: "ssh-keyscan -H github.com >> {{ ansible_env.HOME }}/.ssh/known_hosts"
  changed_when: true

- name: Download portfolio
  ansible.builtin.git:
    repo: "{{ git_url }}"
    dest: "{{ location }}"
    version: main

- name: Install language dependencies
  ansible.builtin.apt:
    name: "{{ item }}"
    state: present
  with_items:
    - autoconf
    - bison
    - build-essential
    - libssl-dev
    - libyaml-dev
    - libreadline6-dev
    - zlib1g-dev
    - libncurses5-dev
    - libffi-dev
    - libgdbm6
    - libgdbm-dev
    - libdb-dev
    - libpq-dev
  become: true

- name: asdf install
  ansible.builtin.shell: >
    set -o pipefail &&
    asdf install | grep -v "already installed"
  args:
    chdir: "{{ location }}"
    executable: /bin/zsh
  register: asdf_results
  changed_when: asdf_results.stdout_lines | count > 0
  failed_when: false

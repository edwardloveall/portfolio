# Initially generated by nginxconfig.io

user www-data;
pid /run/nginx.pid;
worker_processes auto;
worker_rlimit_nofile 65535;

events {
  multi_accept on;
  worker_connections 65535;
}

http {
  charset utf-8;
  sendfile on;
  tcp_nopush on;
  tcp_nodelay on;
  log_not_found off;
  types_hash_max_size 2048;
  map_hash_bucket_size 128;
  client_max_body_size 25M;

  # MIME
  include mime.types;
  default_type application/octet-stream;

  # logging
  map $request $loggable {
    ~/_ignition/execute-solution 0;
    ~%3Cphp%3E 0;
    ~XDEBUG_SESSION_START 0;
    ~/.env 0;
    ~/.git/.* 0;
    ~/remote/fgt_lang 0;
    ~/actuator/health 0;
    ~/admin 0;
    ~/admin//config.php 0;
    ~/admin/config.php 0;
    ~/api/jsonws/invoke 0;
    ~/Autodiscover/Autodiscover.xml 0;
    ~/bin/sh 0;
    ~/config/getuser\?index= 0;
    ~/console/ 0;
    ~/ecp/Current/exporttool/microsoft.exchange.ediscovery.exporttool.application 0;
    ~/GponForm/diag_Form\?style/ 0;
    ~index.php 0;
    ~/mifs.+LogService 0;
    ~/owa/auth/logon.aspx\?url=https://1/ecp/ 0;
    ~/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php 0;
    ~/webfig/ 0;
    default 1;
  }
  access_log /var/log/nginx/access.log combined if=$loggable;

  # access_log /var/log/nginx/access.log;
  error_log /var/log/nginx/error.log warn;

  # limits
  limit_req_log_level warn;
  limit_req_zone $binary_remote_addr zone=one:10m rate=30r/m;

  # SSL
  ssl_session_timeout 1d;
  ssl_session_cache shared:SSL:10m;
  ssl_session_tickets off;

  # Diffie-Hellman parameter for DHE ciphersuites
  ssl_dhparam /etc/nginx/dhparam.pem;

  # Mozilla Intermediate configuration
  ssl_protocols TLSv1.2 TLSv1.3;
  ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;

  # OCSP Stapling
  ssl_stapling on;
  ssl_stapling_verify on;
  resolver 1.1.1.1 1.0.0.1 8.8.8.8 8.8.4.4 208.67.222.222 208.67.220.220 valid=60s;
  resolver_timeout 2s;

  # load configs
  include /etc/nginx/conf.d/*.conf;
  include /etc/nginx/sites-enabled/*;
}
